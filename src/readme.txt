◇ FDS: FDX68 File Selector
  Hiroaki GOTO as GORRY / http://GORRY.hauN.org/
  Version 20200512a

========================================================================
1. 概要
========================================================================

FDSは、FDX68を搭載したRaspberry Pi実機上で動作するFDXイメージ（仮想フロッ
ピーディスク）ファイルセレクタです。 実機に接続したディスプレイ、または
sshなどで接続したコンソール上でキーボードを使用して、軽快にFDXイメージ
ファイルの選択を行い、FDDエミュレータへの挿入や内容確認などを行うことが
できます。

FDX68は、GIMONS氏が制作する「フロッピーディスクドライブエミュレータ & 
コントローラ」です。Raspberry Piにシールドを装着し、X68000などに接続し
てフロッピーディスクドライブの代わりとして使用することができます。詳細
は以下を参照してください。
- http://retropc.net/gimons/fdx68/

本プロダクトの名称は「FDS」ですが、Twitterなどで議論を行う際のハッシュ
タグとしては「#fds68k」を推奨します。

========================================================================
2. 動作環境
========================================================================

FDSの動作には、以下の環境が必要です。

1. ハードウェア

    - Raspberry Pi 3 Model B以降
    - FDX68 シールド
    - ディスプレイ（72x20文字以上）
    - USBキーボード
    ※ sshなどのコンソール環境が使用できれば、ディスプレイ＆キーボードは
       なくても使用できます。

2. OS

    - Raspbian Buster Lite: February 2020
    ※ GUI環境は不要です。コンソールで動作します。

3. ソフトウェア

    - FDX68
    ※ 実機接続ディスプレイでファイル名にかな＆漢字を使う場合、fbtermな
       どの漢字対応ターミナルが必要です。

========================================================================
3. インストールと実行
========================================================================

1. ソースパッケージをダウンロードして展開します。「fds/fds」が実行ファイ
   ルです。

2. fds実行ファイルと同じディレクトリに、fdx68システムから以下をコピー
  （またはシンボリックリンクなど）し、実行属性を付けておきます。

    - fddemu
    - fdxtool

3. fds実行ファイルと同じディレクトリに「fdx/X68000/」ディレクトリを作成
   し、その中にFDXイメージファイルを設置します。サブディレクトリを作成し
   ても構いません。

    + fdx/
    | + X68000/
    |   + [FDXイメージファイル] 

4. fds実行ファイルと同じディレクトリに移動し、「sudo ./fdx」を実行しま
   す。root権限昇格のためのパスワードを入力します。

5. [Select System]ダイアログで[X68000]を選ぶと、設置したFDXイメージファ
   イルが表示されます。ファイルにカーソルを移動し、[1]キーを押すと第１
   ドライブにそのファイルが挿入されます。

========================================================================
4. 起動オプション
========================================================================

--noroot
   通常、FDSの起動はsudoコマンドを経由して行います。FDSはfddemuの起動制
   御を行いますが、fddemuの起動にroot権限が必要なためです。
   --norootオプションを付加すると、fddemuの起動制御を行いません。このた
   めroot権限なしで動作するようになります。

   このオプションを付加する場合は、適切なオプションを付加したfddemuを
   事前に起動しておいてください。FDX68の接続先により、適切なオプションは
   異なってきます。

--log
   デバッグに必要なログを出力します。ログは、以下２つが出力されます。

   - fds.log    FDSの動作経過が出力されます。
   - fddemu.log FDSから起動したfddemuの動作経過が出力されます。

   この指定を行わなくても、致命的なエラーが発生した場合は fds.log に
   記録されます。

--help
   起動オプションの一覧が出力されます。

========================================================================
5. 画面の説明
========================================================================

------------------------------------------------------------------------
5.1. Select System
------------------------------------------------------------------------

   FDSを起動すると、「Select System」ダイアログが表示されます。

    +-----------------+
    | [Select System] |
    |                 |
    |  X68000         |
    |  X1             |
    |  PC-8801        |
    |  PC-9801        |
    |  FM77AV         |
    |  [ Quit ]       |
    +-----------------+

   カーソルキーでシステムを選び、Enterキーで決定します。
   [Quit]を選ぶと、FDSは終了します。

------------------------------------------------------------------------
5.2. メイン画面
------------------------------------------------------------------------

   システムを決定すると、メイン画面が表示されます。

    +---------------------------------------------------++-----------------+
    | Drive 0  00* fdx/X68000/アフターバーナーⅡ/1.fdx  ||[KEY INSTRUCTION]|
    | Drive 1  00* fdx/X68000/アフターバーナーⅡ/2.fdx  ||                 |
    +---------------------------------------------------+|A: Auto Set      |
    |[DIR] fdx/X68000/                                  ||C: Create Disk   |
    |      アフターバーナーⅡ/                          ||D: Dup Disk      |
    +---------------------------------------------------+|E: Eject Drive   |
    |  ../                                              ||K: Make Directory|
    |  Sub/                                             ||N: Edit Disk Name|
    |  Disk1.fdx                                        ||O: Edit Protect  |
    | *Disk2.fdx                                        ||P: Protect Drive |
    |                                                   ||R: Rename Disk   |
    |                                                   ||W: Protect Disk  |
    |                                                   ||X: Delete Disk   |
    |                                                   ||#: Shell         |
    |                                                   ||                 |
    |                                                   ||1: Set 1st Drive |
    +---------------------------------------------------+|2: Set 2nd Drive |
    |[1.fdx]                                            ||0: Eject All     |
    |Format:rev3(RAW)  Protect:ON   Cyl:84  Head:2      ||                 |
    |Samples/Trk:166912  Rate:8000kbps  Motor:360rpm    ||                 |
    |Name:[1.fdx]                                       ||                 |
    +---------------------------------------------------++-----------------+

   メイン画面は５つのビューに分かれています。
   - Filerビュー
   - FDDビュー
   - Pathビュー
   - Infoビュー
   - Helpビュー

------------------------------------------------------------------------
5.3. Filerビュー
------------------------------------------------------------------------

   Filerビューでは、対象となるファイルをリストから選択します。

    +---------------------------------------------------+
    |  ../                                              |
    |  Sub/                                             |
    |  Disk1.fdx                                        |
    | *Disk2.fdx                                        |
    |                                                   |
    |                                                   |
    |                                                   |
    |                                                   |
    |                                                   |
    |                                                   |
    +---------------------------------------------------+

   リストには、項目が以下のように表示されます。

    - "../"。親ディレクトリを示します。
    - "Sub/"。サブディレクトリを示します。
    - "Disk1.fdx"。FDXイメージファイルを示します。
    - "*Disk2.fdx"。書き込み権限のないFDXイメージファイルを示します。
      書き込み権限のないFDXイメージファイルは、「ライトプロテクトされた
      フロッピーディスク」と同様の扱いになります。

   現在対象となっているファイルには、カーソルが表示されています。
   ファイルを選択するために、以下のキーを使用します。

    - 矢印キー（↑↓）
      カーソルを上下に移動します。
    - PageUp/Downキー
      カーソルを上下に大きく移動します。
    - Home/Endキー
      カーソルをリストの先頭/末尾に移動します。
    - Backspaceキー
      親ディレクトリに移動します。
    - Enterキー
      ディレクトリを選択した場合、そのディレクトリに移動します。

    これ以外の操作については、「操作の説明」を参照してください。

------------------------------------------------------------------------
5.4. FDDビュー
------------------------------------------------------------------------

   FDDビューでは、現在のFDDエミュレータの状態を表示します。

    +---------------------------------------------------+
    | Drive 0  00* fdx/X68000/アフターバーナーⅡ/1.fdx  |
    | Drive 1       -- [EMPTY] --                       |
    +---------------------------------------------------+

   上から順に、第１ドライブ／第２ドライブの状態を示しています。それぞれ
   のドライブの名称は、選択したシステムにより異なります。例えばX68000で
   は「Drive 0/Drive 1」ですが、機種によっては「Drive 1/Drive 2」などに
   なります。

   「00*」の部分は、「FDDのヘッド位置」と「ライトプロテクト状態」を示し
   ています。
   
    - ヘッド位置は、FDX68を接続している（X68000などの）ホストコンピュー
      タ側の指示により、リアルタイムで変動します。
    - "*"が表示されている場合、そのドライブには書き込みができない（ライ
      トプロテクト状態である）ことを示します。

   最後に、ディスクが挿入されていれば、そのFDXイメージファイル名が表示
   されます。されていない場合は、「-- [EMPTY] --」が表示されます。

------------------------------------------------------------------------
5.5. Infoビュー
------------------------------------------------------------------------

   Infoビューでは、Filerビューで選択している項目についての内容が表示さ
   れます。

   サブディレクトリを選択しているときは、「サブディレクトリ内のFDXイメー
   ジファイル」が表示されます。

    +---------------------------------------------------+
    |[fdx/X68000/アフターバーナーⅡ/]                   |
    | 1.fdx                                             |
    | 2.fdx                                             |
    |                                                   |
    +---------------------------------------------------+

   FDXイメージファイルを選択しているときは、「FDXイメージファイルの詳細」
   が表示されます。

    +---------------------------------------------------+
    |[1.fdx]                                            |
    |Format:rev3(RAW)  Protect:ON   Cyl:84  Head:2      |
    |Samples/Trk:166912  Rate:8000kbps  Motor:360rpm    |
    |Name:[1.fdx]                                       |
    +---------------------------------------------------+

------------------------------------------------------------------------
5.6. Helpビュー
------------------------------------------------------------------------

   Helpビューでは、Filerビューで選択している項目に応じて、可能な操作が
   表示されています。

    +-----------------+
    |[KEY INSTRUCTION]|
    |                 |
    |A: Auto Set      |
    |C: Create Disk   |
    |D: Dup Disk      |
    |E: Eject Drive   |
    |K: Make Directory|
    |N: Edit Disk Name|
    |O: Edit Protect  |
    |P: Protect Drive |
    |R: Rename Disk   |
    |W: Protect Disk  |
    |X: Delete Disk   |
    |#: Shell         |
    |                 |
    |1: Set 1st Drive |
    |2: Set 2nd Drive |
    |0: Eject All     |
    |                 |
    |                 |
    |                 |
    +-----------------+

========================================================================
6. 操作の説明
========================================================================

メイン画面で可能な操作は、以下の通りです。

------------------------------------------------------------------------
6.1. Auto Set
------------------------------------------------------------------------

   [A]またはスペースキーを押すと、「ディスクの自動セット」が行われます。
   「ディスクの自動セット」では、以下の作業が行われます。一般的なタイト
   ルであれば、この操作のみで準備を行うことができます。

   1. 全ドライブからディスクを排出します。

   2. ディレクトリ内のFDXイメージファイルから、ファイル名末尾が"1"また
      は"A"で始まるもの（「Disk1.fdx」など）を探し、第１ドライブへ挿入
      します。

   3. 同様に、ファイル名末尾が"2"または"B"で始まるものを探し、第２ドラ
      イブへ挿入します。

   サブディレクトリを選択しているときは、そのサブディレクトリ内部に対し
   てこの操作が行われます。それ以外のときは、現在のディレクトリに対して
   この操作が行われます。

------------------------------------------------------------------------
6.2. Create Disk
------------------------------------------------------------------------

   [C]キーを押すと、「新しいFDXイメージファイル（ブランクディスク）の作
   成」が行われます。

   まず、ディスクのタイプを選びます。

    +------------------+
    | [Select Format]  |
    |                  |
    |  2D              |
    |  2DD(640KB)      |
    |  2DD(720KB)      |
    |  2HD(1.2MB,JP)   |
    |  2HD(1.4MB,PC/AT)|
    |  [ Cancel ]      |
    +------------------+

   続いて、新しいFDXイメージファイルの保存ファイル名を入力します。

    +--------------------------------------+
    | Create [2HD(1.2MB,JP)] Disk:         |
    |                                      |
    | new.fdx                              |
    +--------------------------------------+

   ファイル名を入力すると、Filerビューに新しいFDXイメージファイルが追加
   されます。

------------------------------------------------------------------------
6.3. Dup Disk
------------------------------------------------------------------------

   [C]または[=]キーを押すと、「FDXイメージファイルの複製」が行われます。

   複製先のFDXイメージファイル名を入力します。

    +--------------------------------------+
    | Copy to:                             |
    |                                      |
    | Disk1_Copy.fdx                       |
    +--------------------------------------+

   ファイル名を入力すると、Filerビューに新しいFDXイメージファイルが追加
   されます。

------------------------------------------------------------------------
6.4. Eject Drive
------------------------------------------------------------------------

   [E]キーを押すと、「FDXイメージファイルの排出」が行われます。

   排出するドライブを選択します。

    +---------------+
    | [Eject Drive] |
    |               |
    |  Drive 0      |
    |  Drive 1      |
    +---------------+

   ドライブを選択すると、「FDXイメージファイルの排出」が行われます、FDD
   ビューの表示内容が変化することで、動作を確認することができます。

------------------------------------------------------------------------
6.5. Make Directory
------------------------------------------------------------------------

   [K]または[+]キーを押すと、「ディレクトリの作成」が行われます。

   作成するディレクトリ名を入力します。

    +--------------------------------------+
    | Make Directory:                      |
    |                                      |
    | newdir                               |
    +--------------------------------------+

   ディレクトリ名が入力されると、Filerビューに新しいディレクトリが追加さ
   れます。

------------------------------------------------------------------------
6.6. Edit Disk Name
------------------------------------------------------------------------

   [N]キーを押すと、「FDXイメージファイルのディスク名の編集」が行われま
   す。書き込み権限のないFDXイメージファイルに対しては、この作業を行うこ
   とはできません。

   新しいディスク名を入力します。

    +--------------------------------------+
    | Make Directory:                      |
    |                                      |
    | newdir                               |
    +--------------------------------------+

   ディスク名が入力されると、Infoビューに新しいディスク名が表示されます。

------------------------------------------------------------------------
6.7. Edit Protect
------------------------------------------------------------------------

   [O]キーを押すと、「FDXイメージファイルのプロテクト情報の編集」が行わ
   れます。書き込み権限のないFDXイメージファイルに対しては、この作業を
   行うことはできません。

   プロテクト情報を選択します。

    +----------------+
    | [Edit Protect] |
    |                |
    |  On            |
    |  Off           |
    |  [ Cancel ]    |
    +----------------+

   プロテクト情報を選択すると、Infoビューに新しいプロテクト情報が表示さ
   れます。

------------------------------------------------------------------------
6.8. Protect Drive
------------------------------------------------------------------------

   [P]キーを押すと、「ドライブのプロテクト情報の一時的な変更」が行われ
   ます。この作業はFDXイメージファイルのプロテクト情報を書き換えません。
   ただし、「プロテクトOn状態のFDXイメージファイル」や「書き込み権限の
   ないFDXイメージファイル」を挿入している場合には、この機能は無効化さ
   れます。

   プロテクト情報を選択します。

    +----------------+
    | [Edit Protect] |
    |                |
    |  On            |
    |  Off           |
    |  [ Cancel ]    |
    +----------------+

   プロテクト情報を選択すると、Infoビューに新しいプロテクト情報が表示さ
   れます。

------------------------------------------------------------------------
6.9. Rename Disk / Rename Dir
------------------------------------------------------------------------

   [R]または[?]キーを押すと、「FDXイメージファイルやディレクトリの名前
   の変更」が行われます。

   新しい名前を入力します。

    +--------------------------------------+
    | Rename to:                           |
    |                                      |
    | Disk1.fdx                            |
    +--------------------------------------+

   名前の変更が終了すると、Filerビューに反映されます。

------------------------------------------------------------------------
6.10. Protect Disk
------------------------------------------------------------------------

   [W]キーを押すと、「FDXイメージファイルへの書き込み権限の変更」が行わ
   れます。

   新しい状態を選択します。

    +----------------+
    | [Protect Disk] |
    |                |
    |  On            |
    |  Off           |
    |  [ Cancel ]    |
    +----------------+

   書き込み権限の変更が終了すると、Filerビューに反映されます。

------------------------------------------------------------------------
6.11. Delete Disk / Delete Dir
------------------------------------------------------------------------

   [X]または[Del]キーを押すと、「FDXイメージファイルやディレクトリの削
   除」が行われます。

   本当に削除してよいなら、'Y'を入力して[Enter]を押します。

    +----------------------+
    | Input 'Y' to Delete: |
    |                      |
    |                      |
    +----------------------+

   削除が終了すると、Filerビューに反映されます。

------------------------------------------------------------------------
6.12. Shell
------------------------------------------------------------------------

   [#]キーを押すと、「シェルの起動」が行われます。

   現在のディレクトリをカレントディレクトリとして、シェルが起動します。
   シェルをexitすると、FDSの画面に戻ります。

------------------------------------------------------------------------
6.13. Set 1st/2nd Drive
------------------------------------------------------------------------

   [1]または[2]キーを押すと、「FDXイメージファイルのドライブへの挿入」
   が行われます。

   FDXイメージファイルを選択している状態で[1]キーを押すと、そのファイル
   が第１ドライブへ挿入されます。[2]キーを押すと、同様に第２ドライブへ
   挿入されます。
   第１・第２ドライブに同じFDXイメージファイルを挿入しないよう、注意し
   てください。

------------------------------------------------------------------------
6.14. Eject All
------------------------------------------------------------------------

   [0]キーを押すと、「全ドライブからのFDXイメージファイルの排出」が行わ
   れます。

   ドライブを選択すると、「FDXイメージファイルの排出」が行われます、FDD
   ビューの表示内容が変化することで、動作を確認することができます。

========================================================================
7. 設定ファイルfds.ini
========================================================================

fds.ini を編集することで、FDSの内部動作を変更することができます。

------------------------------------------------------------------------
7.1. [GLOBAL]セクション
------------------------------------------------------------------------

   [GLOBAL]セクションは、最も基本的な設定を行います。

   1. FDDEMUCMD
      FDDEMUCMDは、fddemu実行ファイルを指します。「fds実行ファイルと同
      じディレクトリ」以外にfddemu実行ファイルが置きたい場合は、この項
      目で変更することができます。

   2. FDXTOOLCMD
      FDXTOOLCMDは、fdxtool実行ファイルを指します。「fds実行ファイルと
      同じディレクトリ」以外にfdxtool実行ファイルが置きたい場合は、この
      項目で変更することができます。

   3. FORMATS
      FORMATSは、[FORMAT]セクションの個数を指定します。
      ここで表示した数が、[Create Disk]コマンドの[Select Format]ダイア
      ログで表示されます。

   4. SYSTEMS
      SYSTEMSは、[SYSTEM]セクションの個数を指定します。
      ここで表示した数が、FDX起動時の[Select System]ダイアログで表示さ
      れます。

------------------------------------------------------------------------
7.2. [SYSTEM]セクション
------------------------------------------------------------------------

   [SYSTEM]セクションは、FDX起動時の[Select System]ダイアログで表示され
   る内容です。
   実際は[SYSTEM-1]のように末尾に数値が付加され、1から[GLOBAL]:SYSTEMSで
   指定した数だけセクションが必要です。

   1. NAME
      [Select System]ダイアログで表示する名前です。

   2. ROOTDIR
      ROOTDIRは、そのシステムで使用するFDXイメージファイルのルートディ
      レクトリを指定します。

   3. FDDEMUOPT
      FDDEMUOPTは、このシステムを選んだときに起動させる fddemu実行ファ
      イルに付加するオプションを指定します。

   4. DRIVE0NAME
      DRIVE0NAMEは、そのシステムで表示する「第１ドライブの名前」を指定
      します。

   5. DRIVE1NAME
      DRIVE1NAMEは、そのシステムで表示する「第２ドライブの名前」を指定
      します。

------------------------------------------------------------------------
7.2. [FORMAT]セクション
------------------------------------------------------------------------

   [FORMAT]セクションは、[Create Disk]コマンドの[Select Format]ダイアロ
   グで表示される内容です。
   実際は[FORMAT-1]のように末尾に数値が付加され、1から[GLOBAL]:FORMATSで
   指定した数だけセクションが必要です。

   1. NAME
      [Select Format]ダイアログで表示する名前です。

   2. FDXTOOLOPT
      FDXTOOLOPTは、そのフォーマットを行うためにfdxtool実行ファイルに付
      加するオプションを指定します。

   3. FILENAME
      FILENAMEは、そのフォーマットを行うときにファイルに付けるデフォル
      ト名です。

========================================================================
8. ソースのビルド
========================================================================

ソースのビルドは、Raspberry Pi実機で行います。当方は以下を使用していま
す。

- Raspbian Buster Lite: February 2020

「make」のみで、リリースビルドを行います。「make DEBUG=1」で、デバッグ
ビルドを行うこともできます。デバッグビルドでは、オプション「--log」が常
に付加された状態になります。

なお、本ソースファイルには、VisualStudio用のプロジェクトファイルが含ま
れています。これはUIデバッグ用に用意されているもので、Win32バイナリのビ
ルドは可能ですが「FDX68と連携しての動作は全く行うことができない」もので
す。また、ビルドにはPDCurses mattn版が必要となります。

   - https://github.com/mattn/pdcurses

========================================================================
9. 著作権表記
========================================================================

本プロダクトのうち、後藤 浩昭（GORRY）が制作したソースコードは、
「Apache License Version 2.0」で配布されます。このライセンスに基づいて
の使用・再配布が許可されます。

「Apache License Version 2.0」のライセンス条文は、以下からお読みいただ
けます。

- http://www.apache.org/licenses/LICENSE-2.0.txt （オリジナル）
- APACHE-LICENSE-2.0.txt （ローカルコピー）
- http://sourceforge.jp/projects/opensource/wiki/licenses%2FApache_License_2.0
  （日本語参考訳）

本プロダクトには、限定配布であるfdx68ソースコードからの情報引用が行われ
ていますが、この部分につきましては原作者の許諾を得ています。

本プロダクトには、以下のプロダクトを含んでいます。

- wcwidth https://github.com/termux/wcwidth

本プロダクトは、以下URLを配布先とします。利便性などのためにこれ以外の
URLで配布することがありますが、以下が最も正式なものであり、完全な最新の
パッケージを得ることができます。

http://GORRY.hauN.org/pw/?fds

========================================================================
10. 連絡先
========================================================================

後藤 浩昭 / GORRY
http://GORRY.hauN.org/
twitter/gorry5

========================================================================
[EOF]
